<!DOCTYPE html>
<html>

<head>
  <title>Blueprint Drawing thingy</title>
  <style>
    canvas {
      border: 1px solid black;
    }

    .canvas-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      /* Set the aspect ratio to 16:9 */
    }

    .canvas-container canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  </style>




  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      const bpValue = urlParams.get('bp');
      const blueprintTextbox = document.getElementById('blueprint-textbox');
      blueprintTextbox.value = bpValue;
    });
  </script>


</head>

<body>
  <form action="" method="get">
    <label for="blueprint-textbox">Blueprint:</label><br>
    <textarea id="blueprint-textbox" rows="10" cols="50" name="bp"></textarea><br>
    <button id="draw-button" type="submit">Draw Blueprint</button>
  </form>
  <br>
  <div>
    <p>Stability. Cost:<span id="stability-cost"></span>, Conferred: <span id="stability-conferred"></span></p>
    <p>Power Consumption. Idle: <span id="power-consumption-idle"></span>, Max:<span id="power-consumption-max"></span>, Produced:<span id="power-produced"></span></p>
    <p>Heat Rate: <span id="heat-rate"></span></p>
  </div>
  <div class="canvas-container">
    <canvas id="myCanvas" width="500" height="500"></canvas>
  </div>


  <script type="module">
    import { decode, drawBoxes, get_rotated_object_info, readItems, readData } from "./main.js";



    const canvas = document.getElementById('myCanvas');
    const stabilityCostElement = document.getElementById("stability-cost");
    const stabilityconferredElement = document.getElementById("stability-conferred");
    const powerConsumptionIdleElement = document.getElementById("power-consumption-idle");
    const powerConsumptionMaxElement = document.getElementById("power-consumption-max");
    const powerProducedElement = document.getElementById("power-produced");
    const heatRateElement = document.getElementById("heat-rate");

    const queryParams = new URLSearchParams(window.location.search);
    const bps = queryParams.get('bp');
    const blueprint = decode(bps);
    const items = readItems(blueprint);
    const itemData = await readData("itemData.json")


    let totalStabilityCost = 0, totalPowerIdle = 0, totalPowerMax = 0, totalPowerProduced = 0, totalHeatRate = 0, totalStabilityConferred = 0;
    items.forEach(box => {
      let itemInfo = itemData[box.itemName];
      if (!itemInfo) {
        console.log("ERROR: No item info for " + box.itemName);
      } else {
        totalStabilityCost += itemInfo.stabilityCost;
        totalStabilityConferred += itemInfo.stabilityConferred;
        totalPowerIdle += itemInfo.powerConsumptionIdle;
        totalPowerMax += itemInfo.powerConsumptionMax;
        totalPowerProduced += itemInfo.powerProduction;
        totalHeatRate += itemInfo.heatRate;

      }
    });
    // Set the innerText values
    stabilityCostElement.innerText = totalStabilityCost;
    stabilityconferredElement.innerText = totalStabilityConferred;
    powerConsumptionIdleElement.innerText = totalPowerIdle;
    powerConsumptionMaxElement.innerText = totalPowerMax;
    powerProducedElement.innerText = totalPowerProduced;
    heatRateElement.innerText = totalHeatRate;



    drawBoxes(canvas, items, itemData);

    // drawButton.addEventListener('click', function() {
    //     const bps = blueprintTextbox.value;
    //     const d = decode(bps);
    //     const items = d["Items"].map(item => get_rotated_object_info(item));
    //     drawBoxes(canvas, items);
    //   });





  </script>

</body>

</html>