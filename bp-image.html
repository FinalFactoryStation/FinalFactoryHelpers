<!DOCTYPE html>
<html>

<head>
  <title>Blueprint Drawing thingy</title>
  <style>
    .container {
      width: 90%;
      margin: 0 auto;
      padding: 0 20px;
    }

    canvas {
      border: 1px solid black;

    }

    .canvas-container {
      width: 100%;
      text-align: center;
    }

    .canvas-container canvas {
      /* position: absolute; */
      top: 0;
      left: 0;
      margin: 0 auto;
    }

    #blueprint-textbox {
      resize: none;
      outline: none;
      width: 100%;

    }

    #tooltip {
      z-index: 999;
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      color: #333;
      overflow-y: scroll;
      margin-bottom: 20px;

    }

    .groups {
      margin-bottom: 10px;
    }
  </style>




  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      const bpValue = urlParams.get('bp');
      const blueprintTextbox = document.getElementById('blueprint-textbox');
      blueprintTextbox.value = bpValue;
    });
  </script>


</head>

<body>
  <div class="container">
    <form action="" method="get">
      <label for="blueprint-textbox">Blueprint:</label><br>
      <textarea id="blueprint-textbox" rows="10" cols="50" name="bp"></textarea><br>
      <button id="draw-button" type="submit">Draw Blueprint</button>
    </form>

    <br>
    <div>
      <div id="tooltip">
      </div>
      <div class="canvas-container">
        <canvas id="myCanvas" width="500" height="500"></canvas>
      </div>
    </div>
  </div>

  <script type="module">
    import { decode, drawBoxes, readItems, readData } from "./main.js";



    const canvas = document.getElementById('myCanvas');
    const stabilityCostElement = document.getElementById("stability-cost");
    const stabilityconferredElement = document.getElementById("stability-conferred");
    const powerConsumptionIdleElement = document.getElementById("power-consumption-idle");
    const powerConsumptionMaxElement = document.getElementById("power-consumption-max");
    const powerProducedElement = document.getElementById("power-produced");
    const heatRateElement = document.getElementById("heat-rate");

    const queryParams = new URLSearchParams(window.location.search);
    const bps = queryParams.get('bp');
    const blueprint = decode(bps);
    const items = readItems(blueprint);
    const itemData = await readData("itemData.json")

    // Size of HTML document (same as pageHeight/pageWidth in screenshot).
    var win = window,
      doc = document,
      docElem = doc.documentElement,
      body = doc.getElementsByTagName('body')[0],
      h = win.innerWidth || docElem.clientWidth || body.clientWidth,
      w = win.innerHeight || docElem.clientHeight || body.clientHeight;


    const view = drawBoxes(canvas, items, itemData, h, w);
    canvas.addEventListener("mousemove", view.mouseMoveEventHandler);
    const templateDiv = document.querySelector('#tooltip');

    let groups = view.stationGroupTotals;
    for (let i = 0; i < groups.length; i++) {
      // Get the values from the JSON object
      const group = i; // Set the group index as the loop index
      const stabilityCost = groups[i].totalStabilityCost;
      const stabilityConferred = groups[i].totalStabilityConferred;
      const powerIdle = groups[i].totalPowerIdle;
      const powerMax = groups[i].totalPowerMax;
      const powerProduced = groups[i].totalPowerProduced;
      const heatRate = groups[i].totalHeatRate;
      const totalItems = groups[i].totalItems;
      // Create a new div element for each JSON object
      const div = document.createElement('div');

      // Set the values in the HTML template using the element IDs
      div.innerHTML = `<div class="groups">Structure: <span id="group">${group}</span><br />
                    Contains: <span id="contains">${groups[i].totalItems} stations.</span><br />
                    Stability. Cost:<span id="stability-cost">${stabilityCost}</span>, Conferred: <span id="stability-conferred">${stabilityConferred}</span> <strong>(This is doesn't account for struct or artifacts!)</strong> <br />
                    Power Consumption. Idle: <span id="power-consumption-idle">${powerIdle}</span>, Max:<span id="power-consumption-max">${powerMax}</span>, Produced:<span id="power-produced">${powerProduced}</span><br />
                    Heat Rate: <span id="heat-rate">${heatRate}</span></div>`

      // Append the new div element to the tooltip div element in the HTML template
      templateDiv.appendChild(div);
    }


  </script>

</body>

</html>