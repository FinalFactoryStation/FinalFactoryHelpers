<!DOCTYPE html>
<html>

<head>
  <title>Blueprint Drawing thingy</title>
  <style>
    canvas {
      border: 1px solid black;
    }

    .canvas-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      /* Set the aspect ratio to 16:9 */
    }

    .canvas-container canvas {
      position: absolute;
      top: 0;
      left: 0;
    }

    #tooltip {
      z-index: 999;
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      color: #333;
    }

    .groups {
      margin-bottom: 10px;
    }
  </style>




  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      const bpValue = urlParams.get('bp');
      const blueprintTextbox = document.getElementById('blueprint-textbox');
      blueprintTextbox.value = bpValue;
    });
  </script>


</head>

<body>
  <form action="" method="get">
    <label for="blueprint-textbox">Blueprint:</label><br>
    <textarea id="blueprint-textbox" rows="10" cols="50" name="bp"></textarea><br>
    <button id="draw-button" type="submit">Draw Blueprint</button>
  </form>
  <br>
  <div id="tooltip">
    <!-- Group: <span id="group"></span><br />
    Stability. Cost:<span id="stability-cost"></span>, Conferred: <span id="stability-conferred"></span><br />
    Power Consumption. Idle: <span id="power-consumption-idle"></span>, Max:<span id="power-consumption-max"></span>, Produced:<span id="power-produced"></span><br />
    Heat Rate: <span id="heat-rate"></span> -->
  </div>
  <div class="canvas-container">
    <canvas id="myCanvas" width="500" height="500"></canvas>
  </div>


  <script type="module">
    import { decode, drawBoxes, readItems, readData } from "./main.js";



    const canvas = document.getElementById('myCanvas');
    const stabilityCostElement = document.getElementById("stability-cost");
    const stabilityconferredElement = document.getElementById("stability-conferred");
    const powerConsumptionIdleElement = document.getElementById("power-consumption-idle");
    const powerConsumptionMaxElement = document.getElementById("power-consumption-max");
    const powerProducedElement = document.getElementById("power-produced");
    const heatRateElement = document.getElementById("heat-rate");

    const queryParams = new URLSearchParams(window.location.search);
    const bps = queryParams.get('bp');
    const blueprint = decode(bps);
    const items = readItems(blueprint);
    const itemData = await readData("itemData.json")

    const view = drawBoxes(canvas, items, itemData);
    canvas.addEventListener("mousemove", view.mouseMoveEventHandler);
    const templateDiv = document.querySelector('#tooltip');

    let groups = view.groups;
    for (let i = 0; i < groups.length; i++) {
      // Get the values from the JSON object
      const group = i; // Set the group index as the loop index
      const stabilityCost = groups[i].totalStabilityCost;
      const stabilityConferred = groups[i].totalStabilityConferred;
      const powerIdle = groups[i].totalPowerIdle;
      const powerMax = groups[i].totalPowerMax;
      const powerProduced = groups[i].totalPowerProduced;
      const heatRate = groups[i].totalHeatRate;

      // Create a new div element for each JSON object
      const div = document.createElement('div');

      // Set the values in the HTML template using the element IDs
      div.innerHTML = `<div class="groups">Group: <span id="group">${group}</span><br />
                    Stability. Cost:<span id="stability-cost">${stabilityCost}</span>, Conferred: <span id="stability-conferred">${stabilityConferred}</span><br />
                    Power Consumption. Idle: <span id="power-consumption-idle">${powerIdle}</span>, Max:<span id="power-consumption-max">${powerMax}</span>, Produced:<span id="power-produced">${powerProduced}</span><br />
                    Heat Rate: <span id="heat-rate">${heatRate}</span></div>`

      // Append the new div element to the tooltip div element in the HTML template
      templateDiv.appendChild(div);
    }


  </script>

</body>

</html>